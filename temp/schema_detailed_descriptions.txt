                                                                 Table "public.users"
     Column     |            Type             | Collation | Nullable |          Default          | Storage  | Compression | Stats target | Description 
----------------+-----------------------------+-----------+----------+---------------------------+----------+-------------+--------------+-------------
 id             | uuid                        |           | not null | gen_random_uuid()         | plain    |             |              | 
 email          | character varying(255)      |           | not null |                           | extended |             |              | 
 username       | character varying(100)      |           |          |                           | extended |             |              | 
 password_hash  | character varying(255)      |           |          |                           | extended |             |              | 
 full_name      | character varying(255)      |           |          |                           | extended |             |              | 
 role           | character varying(50)       |           |          | 'user'::character varying | extended |             |              | 
 oauth_provider | character varying(50)       |           |          |                           | extended |             |              | 
 oauth_id       | character varying(255)      |           |          |                           | extended |             |              | 
 preferences    | jsonb                       |           |          | '{}'::jsonb               | extended |             |              | 
 is_active      | boolean                     |           |          | true                      | plain    |             |              | 
 is_verified    | boolean                     |           |          | false                     | plain    |             |              | 
 created_at     | timestamp without time zone |           |          | CURRENT_TIMESTAMP         | plain    |             |              | 
 updated_at     | timestamp without time zone |           |          | CURRENT_TIMESTAMP         | plain    |             |              | 
 deleted_at     | timestamp without time zone |           |          |                           | plain    |             |              | 
Indexes:
    "users_pkey" PRIMARY KEY, btree (id)
    "idx_users_oauth" btree (oauth_provider, oauth_id)
    "idx_users_role" btree (role) WHERE deleted_at IS NULL
    "users_email_key" UNIQUE CONSTRAINT, btree (email)
    "users_username_key" UNIQUE CONSTRAINT, btree (username)
Referenced by:
    TABLE "conversations" CONSTRAINT "conversations_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "documents" CONSTRAINT "documents_uploaded_by_fkey" FOREIGN KEY (uploaded_by) REFERENCES users(id)
    TABLE "feedback" CONSTRAINT "feedback_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id)
    TABLE "messages" CONSTRAINT "messages_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id)
    TABLE "queries" CONSTRAINT "queries_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id)
    TABLE "user_usage_metrics" CONSTRAINT "user_usage_metrics_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id)
Not-null constraints:
    "users_id_not_null" NOT NULL "id"
    "users_email_not_null" NOT NULL "email"
Triggers:
    trigger_users_updated_at BEFORE UPDATE ON users FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()
Access method: heap

                                                                Table "public.documents"
    Column     |            Type             | Collation | Nullable |           Default           | Storage  | Compression | Stats target | Description 
---------------+-----------------------------+-----------+----------+-----------------------------+----------+-------------+--------------+-------------
 id            | uuid                        |           | not null | gen_random_uuid()           | plain    |             |              | 
 document_id   | character varying(255)      |           |          |                             | extended |             |              | 
 document_name | character varying(500)      |           |          |                             | extended |             |              | 
 filename      | character varying(255)      |           |          |                             | extended |             |              | 
 filepath      | character varying(500)      |           |          |                             | extended |             |              | 
 source_file   | text                        |           |          |                             | extended |             |              | 
 category      | character varying(100)      |           | not null | 'Kh√°c'::character varying   | extended |             |              | 
 document_type | character varying(50)       |           |          |                             | extended |             |              | 
 uploaded_by   | uuid                        |           |          |                             | plain    |             |              | 
 total_chunks  | integer                     |           |          | 0                           | plain    |             |              | 
 metadata      | jsonb                       |           |          |                             | extended |             |              | 
 status        | character varying(50)       |           |          | 'active'::character varying | extended |             |              | 
 created_at    | timestamp without time zone |           |          | CURRENT_TIMESTAMP           | plain    |             |              | 
 updated_at    | timestamp without time zone |           |          | CURRENT_TIMESTAMP           | plain    |             |              | 
Indexes:
    "documents_pkey" PRIMARY KEY, btree (id)
    "documents_document_id_key" UNIQUE CONSTRAINT, btree (document_id)
    "idx_documents_category" btree (category) WHERE status::text = 'active'::text
    "idx_documents_uploader" btree (uploaded_by)
Foreign-key constraints:
    "documents_uploaded_by_fkey" FOREIGN KEY (uploaded_by) REFERENCES users(id)
Referenced by:
    TABLE "citations" CONSTRAINT "citations_document_id_fkey" FOREIGN KEY (document_id) REFERENCES documents(id)
    TABLE "document_chunks" CONSTRAINT "document_chunks_document_id_fkey" FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE
Not-null constraints:
    "documents_id_not_null" NOT NULL "id"
    "documents_category_not_null" NOT NULL "category"
Access method: heap

                                                         Table "public.document_chunks"
      Column      |            Type             | Collation | Nullable |      Default      | Storage  | Compression | Stats target | Description 
------------------+-----------------------------+-----------+----------+-------------------+----------+-------------+--------------+-------------
 id               | uuid                        |           | not null | gen_random_uuid() | plain    |             |              | 
 chunk_id         | character varying(255)      |           | not null |                   | extended |             |              | 
 document_id      | uuid                        |           | not null |                   | plain    |             |              | 
 content          | text                        |           | not null |                   | extended |             |              | 
 chunk_index      | integer                     |           | not null |                   | plain    |             |              | 
 section_title    | character varying(500)      |           |          |                   | extended |             |              | 
 hierarchy_path   | text[]                      |           |          |                   | extended |             |              | 
 keywords         | text[]                      |           |          |                   | extended |             |              | 
 concepts         | text[]                      |           |          |                   | extended |             |              | 
 entities         | jsonb                       |           |          |                   | extended |             |              | 
 char_count       | integer                     |           |          |                   | plain    |             |              | 
 has_table        | boolean                     |           |          | false             | plain    |             |              | 
 has_list         | boolean                     |           |          | false             | plain    |             |              | 
 is_complete_unit | boolean                     |           |          | true              | plain    |             |              | 
 retrieval_count  | integer                     |           |          | 0                 | plain    |             |              | 
 created_at       | timestamp without time zone |           |          | CURRENT_TIMESTAMP | plain    |             |              | 
 updated_at       | timestamp without time zone |           |          | CURRENT_TIMESTAMP | plain    |             |              | 
Indexes:
    "document_chunks_pkey" PRIMARY KEY, btree (id)
    "document_chunks_chunk_id_key" UNIQUE CONSTRAINT, btree (chunk_id)
    "idx_document_chunks_document" btree (document_id)
    "idx_document_chunks_fts" gin (to_tsvector('english'::regconfig, content))
Foreign-key constraints:
    "document_chunks_document_id_fkey" FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE
Referenced by:
    TABLE "citations" CONSTRAINT "citations_chunk_id_fkey" FOREIGN KEY (chunk_id) REFERENCES document_chunks(id)
    TABLE "langchain_pg_embedding" CONSTRAINT "langchain_pg_embedding_chunk_id_fkey" FOREIGN KEY (chunk_id) REFERENCES document_chunks(id) ON DELETE SET NULL
Not-null constraints:
    "document_chunks_id_not_null" NOT NULL "id"
    "document_chunks_chunk_id_not_null" NOT NULL "chunk_id"
    "document_chunks_document_id_not_null" NOT NULL "document_id"
    "document_chunks_content_not_null" NOT NULL "content"
    "document_chunks_chunk_index_not_null" NOT NULL "chunk_index"
Access method: heap

                                                   Table "public.langchain_pg_embedding"
   Column   |            Type             | Collation | Nullable |      Default      | Storage  | Compression | Stats target | Description 
------------+-----------------------------+-----------+----------+-------------------+----------+-------------+--------------+-------------
 uuid       | uuid                        |           | not null | gen_random_uuid() | plain    |             |              | 
 embedding  | vector(1536)                |           |          |                   | external |             |              | 
 document   | text                        |           |          |                   | extended |             |              | 
 cmetadata  | jsonb                       |           |          |                   | extended |             |              | 
 chunk_id   | uuid                        |           |          |                   | plain    |             |              | 
 created_at | timestamp without time zone |           |          | CURRENT_TIMESTAMP | plain    |             |              | 
Indexes:
    "langchain_pg_embedding_pkey" PRIMARY KEY, btree (uuid)
    "idx_langchain_pg_embedding_vector" hnsw (embedding vector_cosine_ops) WITH (m='16', ef_construction='64')
Foreign-key constraints:
    "langchain_pg_embedding_chunk_id_fkey" FOREIGN KEY (chunk_id) REFERENCES document_chunks(id) ON DELETE SET NULL
Not-null constraints:
    "langchain_pg_embedding_uuid_not_null" NOT NULL "uuid"
Access method: heap

                                                                Table "public.conversations"
     Column      |            Type             | Collation | Nullable |            Default            | Storage  | Compression | Stats target | Description 
-----------------+-----------------------------+-----------+----------+-------------------------------+----------+-------------+--------------+-------------
 id              | uuid                        |           | not null | gen_random_uuid()             | plain    |             |              | 
 user_id         | uuid                        |           | not null |                               | plain    |             |              | 
 title           | character varying(500)      |           |          |                               | extended |             |              | 
 summary         | text                        |           |          |                               | extended |             |              | 
 rag_mode        | character varying(50)       |           |          | 'balanced'::character varying | extended |             |              | 
 category_filter | text[]                      |           |          |                               | extended |             |              | 
 message_count   | integer                     |           |          | 0                             | plain    |             |              | 
 total_tokens    | integer                     |           |          | 0                             | plain    |             |              | 
 total_cost_usd  | numeric(10,4)               |           |          | 0                             | main     |             |              | 
 created_at      | timestamp without time zone |           |          | CURRENT_TIMESTAMP             | plain    |             |              | 
 last_message_at | timestamp without time zone |           |          |                               | plain    |             |              | 
 deleted_at      | timestamp without time zone |           |          |                               | plain    |             |              | 
Indexes:
    "conversations_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "conversations_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "messages" CONSTRAINT "messages_conversation_id_fkey" FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE
    TABLE "queries" CONSTRAINT "queries_conversation_id_fkey" FOREIGN KEY (conversation_id) REFERENCES conversations(id)
Not-null constraints:
    "conversations_id_not_null" NOT NULL "id"
    "conversations_user_id_not_null" NOT NULL "user_id"
Access method: heap

                                                              Table "public.messages"
       Column       |            Type             | Collation | Nullable |      Default      | Storage  | Compression | Stats target | Description 
--------------------+-----------------------------+-----------+----------+-------------------+----------+-------------+--------------+-------------
 id                 | uuid                        |           | not null | gen_random_uuid() | plain    |             |              | 
 conversation_id    | uuid                        |           | not null |                   | plain    |             |              | 
 user_id            | uuid                        |           | not null |                   | plain    |             |              | 
 role               | character varying(20)       |           | not null |                   | extended |             |              | 
 content            | text                        |           | not null |                   | extended |             |              | 
 sources            | jsonb                       |           |          |                   | extended |             |              | 
 processing_time_ms | integer                     |           |          |                   | plain    |             |              | 
 tokens_total       | integer                     |           |          |                   | plain    |             |              | 
 feedback_rating    | integer                     |           |          |                   | plain    |             |              | 
 created_at         | timestamp without time zone |           |          | CURRENT_TIMESTAMP | plain    |             |              | 
Indexes:
    "messages_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "messages_conversation_id_fkey" FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE
    "messages_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id)
Referenced by:
    TABLE "citations" CONSTRAINT "citations_message_id_fkey" FOREIGN KEY (message_id) REFERENCES messages(id) ON DELETE CASCADE
    TABLE "feedback" CONSTRAINT "feedback_message_id_fkey" FOREIGN KEY (message_id) REFERENCES messages(id) ON DELETE CASCADE
    TABLE "queries" CONSTRAINT "queries_message_id_fkey" FOREIGN KEY (message_id) REFERENCES messages(id)
Not-null constraints:
    "messages_id_not_null" NOT NULL "id"
    "messages_conversation_id_not_null" NOT NULL "conversation_id"
    "messages_user_id_not_null" NOT NULL "user_id"
    "messages_role_not_null" NOT NULL "role"
    "messages_content_not_null" NOT NULL "content"
Access method: heap

                                                            Table "public.citations"
     Column      |            Type             | Collation | Nullable |      Default      | Storage  | Compression | Stats target | Description 
-----------------+-----------------------------+-----------+----------+-------------------+----------+-------------+--------------+-------------
 id              | uuid                        |           | not null | gen_random_uuid() | plain    |             |              | 
 message_id      | uuid                        |           | not null |                   | plain    |             |              | 
 document_id     | uuid                        |           | not null |                   | plain    |             |              | 
 chunk_id        | uuid                        |           | not null |                   | plain    |             |              | 
 citation_number | integer                     |           | not null |                   | plain    |             |              | 
 citation_text   | text                        |           |          |                   | extended |             |              | 
 relevance_score | numeric(5,4)                |           |          |                   | main     |             |              | 
 created_at      | timestamp without time zone |           |          | CURRENT_TIMESTAMP | plain    |             |              | 
Indexes:
    "citations_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "citations_chunk_id_fkey" FOREIGN KEY (chunk_id) REFERENCES document_chunks(id)
    "citations_document_id_fkey" FOREIGN KEY (document_id) REFERENCES documents(id)
    "citations_message_id_fkey" FOREIGN KEY (message_id) REFERENCES messages(id) ON DELETE CASCADE
Not-null constraints:
    "citations_id_not_null" NOT NULL "id"
    "citations_message_id_not_null" NOT NULL "message_id"
    "citations_document_id_not_null" NOT NULL "document_id"
    "citations_chunk_id_not_null" NOT NULL "chunk_id"
    "citations_citation_number_not_null" NOT NULL "citation_number"
Access method: heap

                                                               Table "public.queries"
       Column        |            Type             | Collation | Nullable |      Default      | Storage  | Compression | Stats target | Description 
---------------------+-----------------------------+-----------+----------+-------------------+----------+-------------+--------------+-------------
 id                  | uuid                        |           | not null | gen_random_uuid() | plain    |             |              | 
 user_id             | uuid                        |           |          |                   | plain    |             |              | 
 conversation_id     | uuid                        |           |          |                   | plain    |             |              | 
 message_id          | uuid                        |           |          |                   | plain    |             |              | 
 query_text          | text                        |           | not null |                   | extended |             |              | 
 query_hash          | character varying(64)       |           |          |                   | extended |             |              | 
 rag_mode            | character varying(50)       |           |          |                   | extended |             |              | 
 categories_searched | text[]                      |           |          |                   | extended |             |              | 
 retrieval_count     | integer                     |           |          |                   | plain    |             |              | 
 total_latency_ms    | integer                     |           |          |                   | plain    |             |              | 
 tokens_total        | integer                     |           |          |                   | plain    |             |              | 
 estimated_cost_usd  | numeric(10,6)               |           |          |                   | main     |             |              | 
 created_at          | timestamp without time zone |           |          | CURRENT_TIMESTAMP | plain    |             |              | 
Indexes:
    "queries_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "queries_conversation_id_fkey" FOREIGN KEY (conversation_id) REFERENCES conversations(id)
    "queries_message_id_fkey" FOREIGN KEY (message_id) REFERENCES messages(id)
    "queries_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id)
Not-null constraints:
    "queries_id_not_null" NOT NULL "id"
    "queries_query_text_not_null" NOT NULL "query_text"
Access method: heap

                                                           Table "public.feedback"
    Column     |            Type             | Collation | Nullable |      Default      | Storage  | Compression | Stats target | Description 
---------------+-----------------------------+-----------+----------+-------------------+----------+-------------+--------------+-------------
 id            | uuid                        |           | not null | gen_random_uuid() | plain    |             |              | 
 user_id       | uuid                        |           | not null |                   | plain    |             |              | 
 message_id    | uuid                        |           | not null |                   | plain    |             |              | 
 feedback_type | character varying(50)       |           |          |                   | extended |             |              | 
 rating        | integer                     |           |          |                   | plain    |             |              | 
 comment       | text                        |           |          |                   | extended |             |              | 
 created_at    | timestamp without time zone |           |          | CURRENT_TIMESTAMP | plain    |             |              | 
Indexes:
    "feedback_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "feedback_message_id_fkey" FOREIGN KEY (message_id) REFERENCES messages(id) ON DELETE CASCADE
    "feedback_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id)
Not-null constraints:
    "feedback_id_not_null" NOT NULL "id"
    "feedback_user_id_not_null" NOT NULL "user_id"
    "feedback_message_id_not_null" NOT NULL "message_id"
Access method: heap

                                                         Table "public.user_usage_metrics"
       Column        |            Type             | Collation | Nullable |      Default      | Storage  | Compression | Stats target | Description 
---------------------+-----------------------------+-----------+----------+-------------------+----------+-------------+--------------+-------------
 id                  | uuid                        |           | not null | gen_random_uuid() | plain    |             |              | 
 user_id             | uuid                        |           | not null |                   | plain    |             |              | 
 date                | date                        |           | not null |                   | plain    |             |              | 
 total_queries       | integer                     |           |          | 0                 | plain    |             |              | 
 total_messages      | integer                     |           |          | 0                 | plain    |             |              | 
 total_tokens        | bigint                      |           |          | 0                 | plain    |             |              | 
 total_cost_usd      | numeric(10,4)               |           |          | 0                 | main     |             |              | 
 categories_accessed | text[]                      |           |          |                   | extended |             |              | 
 created_at          | timestamp without time zone |           |          | CURRENT_TIMESTAMP | plain    |             |              | 
Indexes:
    "user_usage_metrics_pkey" PRIMARY KEY, btree (id)
    "user_usage_metrics_unique" UNIQUE CONSTRAINT, btree (user_id, date)
Foreign-key constraints:
    "user_usage_metrics_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id)
Not-null constraints:
    "user_usage_metrics_id_not_null" NOT NULL "id"
    "user_usage_metrics_user_id_not_null" NOT NULL "user_id"
    "user_usage_metrics_date_not_null" NOT NULL "date"
Access method: heap

