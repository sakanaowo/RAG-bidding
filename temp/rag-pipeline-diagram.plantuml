@startuml RAG_Pipeline_Classes

skinparam class {
    BackgroundColor #FFFFFF
    BorderColor #2C3E50
}

package "RAG Pipeline" <> {
    
    class QueryEnhancer {
        +config: QueryEnhancerConfig
        --
        +enhance_query(query: str): List[str]
        +multi_query_strategy()
        +hyde_strategy()
        +step_back_strategy()
    }
    
    class VectorStore {
        +collection_name: String
        +embedding_model: String
        --
        +add_documents(chunks: List)
        +similarity_search(query: str, k: int)
        +similarity_search_with_score()
        +clear_cache()
    }
    
    class Reranker <> {
        +model_name: String
        +device: String
        --
        +rerank(query: str, docs: List): List
        +compute_scores()
    }
    
    class BGEReranker {
        +model: AutoModelForSequenceClassification
        +tokenizer: AutoTokenizer
        +batch_size: int
        --
        +rerank(query: str, docs: List): List
        +_batch_score()
    }
    
    class CacheManager {
        +l1_cache: LRUCache
        +l2_cache: RedisCache
        +l3_cache: PostgreSQLCache
        --
        +get(key: str): Optional[Any]
        +set(key: str, value: Any)
        +invalidate(pattern: str)
        +get_stats(): Dict
    }
    
    class QAChain {
        +llm: ChatOpenAI
        +retriever: VectorStoreRetriever
        +prompt_template: str
        --
        +answer(question: str): Dict
        +_format_sources()
        +_validate_answer()
    }
}

package "Document Processing" <> {
    
    class DocumentClassifier {
        +rules: Dict
        --
        +classify_document(filename: str): DocumentType
        +get_features_detected(): List
    }
    
    class DocumentParser <> {
        +file_path: Path
        --
        +parse(): List[Chunk]
        +extract_metadata(): Dict
    }
    
    class DOCXParser {
        +parse(): List[Chunk]
        +extract_hierarchy()
        +extract_tables()
    }
    
    class PDFParser {
        +parse(): List[Chunk]
        +extract_text()
        +detect_layout()
    }
    
    class Chunker {
        +chunk_size: int
        +chunk_overlap: int
        --
        +chunk_document(text: str): List[Chunk]
        +preserve_structure()
    }
    
    class MetadataEnricher {
        +extract_keywords(text: str): List[str]
        +extract_concepts(text: str): List[str]
        +extract_entities(text: str): Dict
    }
}

' Relationships
QueryEnhancer -- VectorStore : uses
VectorStore -- Reranker : uses
BGEReranker --|> Reranker : implements
QAChain -- VectorStore : uses
QAChain -- CacheManager : uses

DocumentClassifier -- DocumentParser : routes to
DOCXParser --|> DocumentParser : implements
PDFParser --|> DocumentParser : implements
DocumentParser -- Chunker : uses
Chunker -- MetadataEnricher : uses
MetadataEnricher -- VectorStore : stores in

@enduml